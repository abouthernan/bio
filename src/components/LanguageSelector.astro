---
import { languages } from '../lib/i18n.js';

const { currentLang = 'es', currentPath = '/' } = Astro.props;

function getLocalizedPath(targetLang, path) {
  if (targetLang === 'es') {
    return path.replace(/^\/en/, '') || '/';
  } else {
    const cleanPath = path.replace(/^\/en/, '');
    return `/en${cleanPath}`;
  }
}
---

<!-- VersiÃ³n compacta para mobile/header -->
<div class="lg:hidden">
  <div class="dropdown dropdown-end">
    <div tabindex="0" role="button" class="btn btn-square btn-ghost">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-5 h-5 stroke-current">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m10.5 21 5.25-11.25L21 21m-9-3h7.5M3 5.621a48.474 48.474 0 0 1 6-.371m0 0c1.681 0 3.445.124 5.227.371M9 5.25V4.875c0-.621.504-1.125 1.125-1.125s1.125.504 1.125 1.125V5.25m0 6.75V4.875c0-.621.504-1.125 1.125-1.125s1.125.504 1.125 1.125V5.25m0 6.75V4.875c0-.621.504-1.125 1.125-1.125s1.125.504 1.125 1.125V12M9 12v2.25"/>
      </svg>
    </div>
    <ul tabindex="0" class="dropdown-content menu bg-base-100 rounded-box z-[1] w-32 p-2 shadow border border-base-300 dropdown-mobile">
      {Object.entries(languages).map(([lang, name]) => (
        <li>
          <a 
            href={getLocalizedPath(lang, currentPath)}
            class={`${lang === currentLang ? 'active' : ''}`}
          >
            <span class="flag-icon">{lang === 'es' ? 'ðŸ‡ªðŸ‡¸' : 'ðŸ‡ºðŸ‡¸'}</span>
            {name}
          </a>
        </li>
      ))}
    </ul>
  </div>
</div>

<!-- VersiÃ³n expandida para desktop/sidebar -->
<div class="hidden lg:flex gap-2">
  {Object.entries(languages).map(([lang, name]) => (
    <a 
      href={getLocalizedPath(lang, currentPath)}
      class={`btn btn-sm ${lang === currentLang ? 'btn-primary' : 'btn-outline'}`}
    >
      <span class="flag-icon">{lang === 'es' ? '' : '' }</span>
      {name}
    </a>
  ))}
</div>

<style>
  /* Posicionamiento especÃ­fico para mobile */
  .dropdown-mobile {
    right: 0 !important;
    left: auto !important;
    top: 100% !important;
    transform: translateX(0) !important;
  }

  /* Asegurar que el dropdown estÃ© alineado correctamente */
  .lg\\:hidden .dropdown {
    position: relative;
  }

  .dropdown-content a.active {
    background-color: #3b82f6;
    color: white;
  }

  .flag-icon {
    font-size: 1em;
    margin-right: 0.25rem;
  }

   /* Personalizar btn-sm solo en este componente */
  .btn-sm {
    padding: 0.25rem 0.75rem;
    font-size: 0.75rem;
    min-height: 1.5rem;
    padding-left: 0rem !important;
    /* Agrega tus modificaciones aquÃ­ */
  }

  /* Prevenir que el dropdown se salga de pantalla */
  @media (max-width: 480px) {
    .dropdown-mobile {
      right: 0 !important;
      left: auto !important;
      min-width: 120px;
    }
  }
</style>